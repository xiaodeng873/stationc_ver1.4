# å·¥ä½œæµç¨‹è¨˜éŒ„é¡¯ç¤ºå•é¡Œè¨ºæ–·æŒ‡å—

## å•é¡Œæè¿°

åœ¨11æœˆ2-8æ—¥é€±æœŸå…§ï¼Œè™•æ–¹æŒçºŒé¡¯ç¤ºä½†å·¥ä½œæµç¨‹è¨˜éŒ„ï¼ˆ21ç­†ï¼š3å¤© x 7æ¬¡/å¤©ï¼‰æ²’æœ‰æ­£å¸¸é¡¯ç¤ºåœ¨è¡¨æ ¼ä¸­ã€‚

## è¨ºæ–·å·¥å…·

æœ¬æ¬¡æ›´æ–°æ–°å¢žäº†ä»¥ä¸‹è¨ºæ–·åŠŸèƒ½ä¾†å¹«åŠ©æŽ’æŸ¥å’Œä¿®å¾©æ­¤é¡žå•é¡Œï¼š

### 1. è¨ºæ–·æŒ‰éˆ•

åœ¨**è—¥ç‰©å·¥ä½œæµç¨‹**é é¢çš„é ‚éƒ¨ï¼Œæ–°å¢žäº†ä¸€å€‹ã€Œè¨ºæ–·ã€æŒ‰éˆ•ï¼š

- **ä½ç½®**ï¼šé é¢å³ä¸Šè§’ï¼Œä½æ–¼ã€Œåˆ·æ–°ã€å’Œã€Œç”Ÿæˆæœ¬é€±å·¥ä½œæµç¨‹ã€æŒ‰éˆ•ä¹‹é–“
- **åŠŸèƒ½**ï¼šåŸ·è¡Œå…¨é¢çš„è¨ºæ–·åˆ†æžï¼Œæª¢æŸ¥æ•¸æ“šå®Œæ•´æ€§å’Œé¡¯ç¤ºå•é¡Œ
- **ä½¿ç”¨æ–¹å¼**ï¼š
  1. é¸æ“‡æœ‰å•é¡Œçš„é™¢å‹
  2. é¸æ“‡å•é¡Œæ—¥æœŸç¯„åœå…§çš„ä»»æ„æ—¥æœŸï¼ˆä¾‹å¦‚11æœˆ2-8æ—¥ä¹‹é–“ï¼‰
  3. é»žæ“Šã€Œè¨ºæ–·ã€æŒ‰éˆ•
  4. æŸ¥çœ‹å½ˆå‡ºçš„è¨ºæ–·çµæžœæ‘˜è¦
  5. æŒ‰ F12 æ‰“é–‹ç€è¦½å™¨æŽ§åˆ¶å°æŸ¥çœ‹è©³ç´°è¨ºæ–·å ±å‘Š

### 2. è¨ºæ–·åŠŸèƒ½è©³è§£

è¨ºæ–·å·¥å…·æœƒåŸ·è¡Œä»¥ä¸‹æª¢æŸ¥ï¼š

#### ç¬¬1æ­¥ï¼šæª¢æŸ¥åœ¨æœè™•æ–¹
- åˆ—å‡ºæ‰€æœ‰åœ¨æœè™•æ–¹
- é¡¯ç¤ºæ¯å€‹è™•æ–¹çš„è©³ç´°è¨­å®šï¼ˆé »çŽ‡é¡žåž‹ã€æ™‚é–“æ§½ã€æ—¥æœŸç¯„åœç­‰ï¼‰
- é©—è­‰è™•æ–¹åœ¨æª¢æŸ¥æœŸé–“çš„æœ‰æ•ˆæ€§
- é€æ—¥åˆ¤æ–·æ¯å€‹è™•æ–¹æ˜¯å¦æ‡‰è©²æœè—¥

#### ç¬¬2æ­¥ï¼šæª¢æŸ¥å·¥ä½œæµç¨‹è¨˜éŒ„
- æŸ¥è©¢æ•¸æ“šåº«ä¸­çš„å¯¦éš›è¨˜éŒ„æ•¸é‡
- æŒ‰æ—¥æœŸçµ±è¨ˆè¨˜éŒ„åˆ†å¸ƒ
- æ¨™ç¤ºç¼ºå¤±è¨˜éŒ„çš„æ—¥æœŸ

#### ç¬¬3æ­¥ï¼šæª¢æŸ¥è¨˜éŒ„èˆ‡è™•æ–¹çš„åŒ¹é…
- é©—è­‰æ¯å€‹è™•æ–¹æ˜¯å¦æœ‰å°æ‡‰çš„å·¥ä½œæµç¨‹è¨˜éŒ„
- åˆ—å‡ºæ¯å€‹è™•æ–¹åœ¨å„æ—¥æœŸçš„è¨˜éŒ„æ•¸é‡
- è­˜åˆ¥ç¼ºå°‘è¨˜éŒ„çš„è™•æ–¹

#### ç¬¬4æ­¥ï¼šè¨ˆç®—é æœŸè¨˜éŒ„æ•¸
- æ ¹æ“šè™•æ–¹è¨­å®šè¨ˆç®—æ‡‰è©²ç”Ÿæˆçš„è¨˜éŒ„ç¸½æ•¸
- å°æ¯”é æœŸè¨˜éŒ„æ•¸èˆ‡å¯¦éš›è¨˜éŒ„æ•¸
- è­˜åˆ¥æ•¸æ“šä¸åŒ¹é…çš„æƒ…æ³

### 3. å¢žå¼·çš„èª¿è©¦æ—¥èªŒ

æ›´æ–°å¾Œçš„ç³»çµ±åœ¨ä»¥ä¸‹æ“ä½œæ™‚æœƒè¼¸å‡ºè©³ç´°æ—¥èªŒåˆ°ç€è¦½å™¨æŽ§åˆ¶å°ï¼ˆF12ï¼‰ï¼š

#### é€±æœŸè¨ˆç®—æ—¥èªŒ
```
ðŸ“… é€±æœŸè¨ˆç®—: è¼¸å…¥æ—¥æœŸ 2025-11-05 (æ˜ŸæœŸä¸‰)
   é€±æ—¥èµ·å§‹: 2025-11-02
   é€±æœŸç¯„åœ: 2025-11-02 ~ 2025-11-08
```

#### è¨˜éŒ„è¼‰å…¥æ—¥èªŒ
```
ðŸ”„ é‡æ–°è¼‰å…¥ç•¶å‘¨å·¥ä½œæµç¨‹è¨˜éŒ„
é™¢å‹ID: 123
é€±æœŸ: 2025-11-02 è‡³ 2025-11-08
âœ… æˆåŠŸè¼‰å…¥ç•¶å‘¨è¨˜éŒ„: 21 ç­†
ðŸ“Š æŒ‰æ—¥æœŸåˆ†å¸ƒ:
  2025-11-02: 7 ç­†
  2025-11-03: 7 ç­†
  2025-11-04: 7 ç­†
  2025-11-05: 0 ç­† âš ï¸
  2025-11-06: 0 ç­† âš ï¸
  2025-11-07: 0 ç­† âš ï¸
  2025-11-08: 0 ç­† âš ï¸
```

## ä½¿ç”¨è¨ºæ–·å·¥å…·è§£æ±ºå•é¡Œçš„æ­¥é©Ÿ

### æ­¥é©Ÿ1ï¼šåŸ·è¡Œè¨ºæ–·

1. å°Žèˆªåˆ°**è—¥ç‰©å·¥ä½œæµç¨‹**é é¢
2. é¸æ“‡æœ‰å•é¡Œçš„é™¢å‹
3. é¸æ“‡11æœˆ2-8æ—¥ç¯„åœå…§çš„ä»»æ„æ—¥æœŸ
4. é»žæ“Šé ‚éƒ¨çš„ã€Œè¨ºæ–·ã€æŒ‰éˆ•
5. ç­‰å¾…è¨ºæ–·å®Œæˆï¼Œé–±è®€å½ˆå‡ºçš„æ‘˜è¦ä¿¡æ¯

### æ­¥é©Ÿ2ï¼šæŸ¥çœ‹è©³ç´°å ±å‘Š

1. æŒ‰ F12 æ‰“é–‹ç€è¦½å™¨é–‹ç™¼è€…å·¥å…·
2. åˆ‡æ›åˆ°ã€ŒConsoleã€ï¼ˆæŽ§åˆ¶å°ï¼‰æ¨™ç±¤
3. æŸ¥æ‰¾ä»¥ä¸‹è¨ºæ–·å ±å‘Šï¼š

```
========== è¨ºæ–·å·¥ä½œæµç¨‹é¡¯ç¤ºå•é¡Œ ==========

===== ç¬¬1æ­¥ï¼šæª¢æŸ¥åœ¨æœè™•æ–¹ =====
âœ… æ‰¾åˆ° X å€‹åœ¨æœè™•æ–¹

è™•æ–¹: è—¥ç‰©åç¨± (ID: xxx)
  é™¢å‹ID: 123
  é »çŽ‡é¡žåž‹: daily
  æ™‚é–“æ§½: ["08:00", "12:00", ...] (7å€‹)
  é–‹å§‹æ—¥æœŸ: 2025-11-01
  çµæŸæ—¥æœŸ: ç„¡
  æœŸé–“æœ‰æ•ˆæ€§: âœ… æœ‰æ•ˆ
  å„æ—¥æœŸæœè—¥åˆ¤æ–·:
    2025-11-02: âœ… éœ€è¦æœè—¥
    2025-11-03: âœ… éœ€è¦æœè—¥
    ...

===== ç¬¬2æ­¥ï¼šæª¢æŸ¥å·¥ä½œæµç¨‹è¨˜éŒ„ =====
âœ… æ‰¾åˆ° X ç­†å·¥ä½œæµç¨‹è¨˜éŒ„

æ¯æ—¥è¨˜éŒ„çµ±è¨ˆ:
  2025-11-02: X ç­†, Y å€‹è™•æ–¹
  ...

===== ç¬¬3æ­¥ï¼šæª¢æŸ¥è¨˜éŒ„èˆ‡è™•æ–¹çš„åŒ¹é… =====
...

===== ç¬¬4æ­¥ï¼šè¨ˆç®—é æœŸè¨˜éŒ„æ•¸ =====
ç¸½è¨ˆ:
  é æœŸç¸½è¨˜éŒ„æ•¸: 21
  å¯¦éš›ç¸½è¨˜éŒ„æ•¸: X
  åŒ¹é…ç‹€æ…‹: âœ… å®Œå…¨åŒ¹é… / âŒ ä¸åŒ¹é…
```

### æ­¥é©Ÿ3ï¼šæ ¹æ“šè¨ºæ–·çµæžœæŽ¡å–è¡Œå‹•

#### æƒ…æ³Aï¼šæ•¸æ“šåº«ä¸­ç„¡è¨˜éŒ„æˆ–è¨˜éŒ„ä¸å®Œæ•´

**è¨ºæ–·çµæžœé¡¯ç¤ºï¼š**
```
é æœŸè¨˜éŒ„æ•¸: 21 ç­†
å¯¦éš›è¨˜éŒ„æ•¸: 0 ç­†ï¼ˆæˆ–å°‘æ–¼21ç­†ï¼‰
```

**è§£æ±ºæ–¹æ³•ï¼š**
1. é»žæ“Šã€Œç”Ÿæˆæœ¬é€±å·¥ä½œæµç¨‹ã€æŒ‰éˆ•
2. ç­‰å¾…ç”Ÿæˆå®Œæˆï¼ˆæœƒé¡¯ç¤ºç”Ÿæˆé€²åº¦ï¼‰
3. é»žæ“Šã€Œåˆ·æ–°ã€æŒ‰éˆ•é‡æ–°è¼‰å…¥æ•¸æ“š
4. é©—è­‰è¨˜éŒ„æ˜¯å¦æ­£å¸¸é¡¯ç¤º

#### æƒ…æ³Bï¼šæœ¬åœ°è¨˜éŒ„èˆ‡æ•¸æ“šåº«ä¸åŒæ­¥

**è¨ºæ–·çµæžœé¡¯ç¤ºï¼š**
```
ç™¼ç¾æ•¸æ“šä¸åŒæ­¥:
æœ¬åœ°è¨˜éŒ„: 0 ç­†
æ•¸æ“šåº«è¨˜éŒ„: 21 ç­†
```

**è§£æ±ºæ–¹æ³•ï¼š**
1. é»žæ“Šã€Œåˆ·æ–°ã€æŒ‰éˆ•
2. é©—è­‰è¨˜éŒ„æ˜¯å¦æ­£å¸¸é¡¯ç¤º

#### æƒ…æ³Cï¼šè™•æ–¹é »çŽ‡è¨­å®šå•é¡Œ

**è¨ºæ–·çµæžœé¡¯ç¤ºï¼š**
```
å„æ—¥æœŸæœè—¥åˆ¤æ–·:
  2025-11-05: âŒ ä¸éœ€æœè—¥
  2025-11-06: âŒ ä¸éœ€æœè—¥
  2025-11-07: âŒ ä¸éœ€æœè—¥
```

**è§£æ±ºæ–¹æ³•ï¼š**
1. å°Žèˆªåˆ°ã€Œè™•æ–¹ç®¡ç†ã€é é¢
2. æ‰¾åˆ°ç›¸é—œè™•æ–¹ä¸¦ç·¨è¼¯
3. æª¢æŸ¥ä¸¦ä¿®æ­£é »çŽ‡è¨­å®šï¼š
   - å¦‚æžœæ˜¯ã€Œé€¢æ˜ŸæœŸXæœã€ï¼Œç¢ºèª `specific_weekdays` åŒ…å«æ‰€éœ€çš„æ˜ŸæœŸæ•¸ï¼ˆ1-7ï¼Œå…¶ä¸­7ä»£è¡¨é€±æ—¥ï¼‰
   - å¦‚æžœæ˜¯ã€Œéš”Xæ—¥æœã€ï¼Œç¢ºèªé–‹å§‹æ—¥æœŸå’Œé–“éš”å¤©æ•¸æ˜¯å¦æ­£ç¢º
   - å¦‚æžœæ˜¯ã€Œå–®/é›™æ—¥æœã€ï¼Œç¢ºèªè¨­å®šæ˜¯å¦ç¬¦åˆé æœŸ
4. ä¿å­˜ä¿®æ”¹å¾Œï¼Œè¿”å›žå·¥ä½œæµç¨‹é é¢
5. é»žæ“Šã€Œç”Ÿæˆæœ¬é€±å·¥ä½œæµç¨‹ã€é‡æ–°ç”Ÿæˆè¨˜éŒ„

## å¸¸è¦‹å•é¡ŒæŽ’æŸ¥

### Q1: ç‚ºä»€éº¼è™•æ–¹é¡¯ç¤ºä½†æ²’æœ‰å·¥ä½œæµç¨‹è¨˜éŒ„ï¼Ÿ

**å¯èƒ½åŽŸå› ï¼š**
1. å·¥ä½œæµç¨‹è¨˜éŒ„å°šæœªç”Ÿæˆ
2. è™•æ–¹çš„é »çŽ‡è¨­å®šå°Žè‡´é€™äº›æ—¥æœŸä¸éœ€è¦æœè—¥
3. è™•æ–¹çš„é–‹å§‹/çµæŸæ—¥æœŸè¨­å®šä¸æ­£ç¢º

**æŽ’æŸ¥æ­¥é©Ÿï¼š**
1. ä½¿ç”¨è¨ºæ–·å·¥å…·æª¢æŸ¥ã€Œå„æ—¥æœŸæœè—¥åˆ¤æ–·ã€
2. æª¢æŸ¥ã€Œé æœŸè¨˜éŒ„æ•¸ã€èˆ‡ã€Œå¯¦éš›è¨˜éŒ„æ•¸ã€çš„å°æ¯”
3. æ ¹æ“šè¨ºæ–·çµæžœæŽ¡å–ç›¸æ‡‰è¡Œå‹•

### Q2: ç‚ºä»€éº¼åªæœ‰éƒ¨åˆ†æ—¥æœŸæœ‰è¨˜éŒ„ï¼Ÿ

**å¯èƒ½åŽŸå› ï¼š**
1. è™•æ–¹ä½¿ç”¨äº†ã€Œé€¢æ˜ŸæœŸXæœã€ï¼Œåªåœ¨ç‰¹å®šæ˜ŸæœŸæœè—¥
2. è™•æ–¹ä½¿ç”¨äº†ã€Œéš”Xæ—¥æœã€ï¼Œåªåœ¨ç‰¹å®šæ—¥æœŸæœè—¥
3. è™•æ–¹ä½¿ç”¨äº†ã€Œå–®/é›™æ—¥æœã€

**æŽ’æŸ¥æ­¥é©Ÿï¼š**
1. æŸ¥çœ‹è¨ºæ–·å ±å‘Šä¸­çš„ã€Œå„æ—¥æœŸæœè—¥åˆ¤æ–·ã€
2. ç¢ºèªè™•æ–¹çš„é »çŽ‡é¡žåž‹å’Œè¨­å®šå€¼
3. å¦‚éœ€ä¿®æ”¹ï¼Œåˆ°è™•æ–¹ç®¡ç†é é¢ç·¨è¼¯è™•æ–¹

### Q3: è¨ºæ–·é¡¯ç¤ºæ•¸æ“šæ­£å¸¸ä½†è¡¨æ ¼ä¸­çœ‹ä¸åˆ°è¨˜éŒ„ï¼Ÿ

**å¯èƒ½åŽŸå› ï¼š**
1. æ™‚é–“æ ¼å¼ä¸åŒ¹é…å°Žè‡´å‰ç«¯ç„¡æ³•æ‰¾åˆ°å°æ‡‰è¨˜éŒ„
2. prescription_id ä¸åŒ¹é…
3. ç€è¦½å™¨ç·©å­˜å•é¡Œ

**æŽ’æŸ¥æ­¥é©Ÿï¼š**
1. æŒ‰ F5 å¼·åˆ¶åˆ·æ–°é é¢
2. æ¸…é™¤ç€è¦½å™¨ç·©å­˜ä¸¦é‡æ–°ç™»å…¥
3. æŸ¥çœ‹æŽ§åˆ¶å°æ˜¯å¦æœ‰éŒ¯èª¤ä¿¡æ¯
4. æª¢æŸ¥è¡¨æ ¼æ¸²æŸ“é‚è¼¯ä¸­çš„è¨˜éŒ„åŒ¹é…æ¢ä»¶

## æŠ€è¡“ç´°ç¯€

### é€±æœŸè¨ˆç®—é‚è¼¯

ç³»çµ±ä½¿ç”¨**é€±æ—¥ä½œç‚ºä¸€é€±çš„èµ·å§‹æ—¥**ä¾†è¨ˆç®—é€±æœŸï¼š

```typescript
const computeWeekDates = (dateStr: string): string[] => {
  const date = new Date(dateStr);
  const day = date.getDay(); // 0=é€±æ—¥, 1=é€±ä¸€, ..., 6=é€±å…­
  const diff = date.getDate() - day;
  const sunday = new Date(date);
  sunday.setDate(diff);
  // ç”Ÿæˆå¾žé€±æ—¥åˆ°é€±å…­çš„7å¤©æ—¥æœŸ
  ...
}
```

**ç¤ºä¾‹ï¼š**
- è¼¸å…¥æ—¥æœŸï¼š2025-11-05ï¼ˆé€±ä¸‰ï¼‰
- è¨ˆç®—çµæžœï¼š2025-11-02ï¼ˆé€±æ—¥ï¼‰~ 2025-11-08ï¼ˆé€±å…­ï¼‰

### è¨˜éŒ„æŸ¥è©¢ç¯„åœ

æ•¸æ“šåº«æŸ¥è©¢ä½¿ç”¨ä»¥ä¸‹æ¢ä»¶ï¼š

```sql
WHERE patient_id = ?
  AND scheduled_date >= '2025-11-02'
  AND scheduled_date <= '2025-11-08'
```

é€™ç¢ºä¿äº†æŸ¥è©¢æœƒæ¶µè“‹æ•´å€‹é€±æœŸçš„æ‰€æœ‰è¨˜éŒ„ã€‚

### é »çŽ‡åˆ¤æ–·é‚è¼¯

ç³»çµ±ä½¿ç”¨èˆ‡ Edge Function ä¸€è‡´çš„é‚è¼¯åˆ¤æ–·è™•æ–¹æ˜¯å¦åœ¨ç‰¹å®šæ—¥æœŸéœ€è¦æœè—¥ï¼š

- **daily**ï¼ˆæ¯æ—¥æœï¼‰ï¼šæ‰€æœ‰æ—¥æœŸéƒ½éœ€è¦æœè—¥
- **every_x_days**ï¼ˆéš”Xæ—¥æœï¼‰ï¼šæ ¹æ“šé–‹å§‹æ—¥æœŸå’Œé–“éš”å¤©æ•¸è¨ˆç®—
- **weekly_days**ï¼ˆé€¢æ˜ŸæœŸXæœï¼‰ï¼šåªåœ¨æŒ‡å®šçš„æ˜ŸæœŸæœè—¥
- **odd_even_days**ï¼ˆå–®/é›™æ—¥æœï¼‰ï¼šæ ¹æ“šæ—¥æœŸæ•¸å­—çš„å¥‡å¶æ€§åˆ¤æ–·
- **every_x_months**ï¼ˆéš”Xæœˆæœï¼‰ï¼šåªåœ¨ç‰¹å®šæœˆä»½çš„ç‰¹å®šæ—¥æœŸæœè—¥

## ç¸½çµ

æ–°å¢žçš„è¨ºæ–·å·¥å…·æä¾›äº†å®Œæ•´çš„å•é¡ŒæŽ’æŸ¥èƒ½åŠ›ï¼š

1. âœ… **è¨ºæ–·æŒ‰éˆ•**ï¼šä¸€éµåŸ·è¡Œå…¨é¢è¨ºæ–·
2. âœ… **è©³ç´°å ±å‘Š**ï¼šåœ¨æŽ§åˆ¶å°é¡¯ç¤ºé€æ­¥æª¢æŸ¥çµæžœ
3. âœ… **å¢žå¼·æ—¥èªŒ**ï¼šè‡ªå‹•è¨˜éŒ„é—œéµæ“ä½œå’Œæ•¸æ“šç‹€æ…‹
4. âœ… **è§£æ±ºå»ºè­°**ï¼šæ ¹æ“šè¨ºæ–·çµæžœæä¾›å…·é«”çš„ä¿®å¾©æ­¥é©Ÿ

ä½¿ç”¨é€™äº›å·¥å…·å¯ä»¥å¿«é€Ÿè­˜åˆ¥ä¸¦è§£æ±ºå·¥ä½œæµç¨‹è¨˜éŒ„é¡¯ç¤ºå•é¡Œï¼Œç¢ºä¿æ•¸æ“šçš„å®Œæ•´æ€§å’Œä¸€è‡´æ€§ã€‚
