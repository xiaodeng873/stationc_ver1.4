# 藥物工作流程表格固定表頭修復

## 修復日期
2025-11-29

## 問題描述
在藥物工作流程頁面向下滾動查看處方時，日期欄目（週日至週六的表頭）會隨著內容一起滾動消失，導致用戶無法看到當前查看的是哪個日期的數據。

## 解決方案
使用 CSS 的 `position: sticky` 屬性將表格的 `<thead>` 元素固定在頂部，使其在垂直滾動時保持可見。

## 修改文件

### 1. `src/pages/MedicationWorkflow.tsx`
- **第 2471 行**：為表格外層容器添加垂直滾動和最大高度限制
  - 添加 `overflow-y-auto` 類啟用垂直滾動
  - 添加 `max-h-[calc(100vh-400px)]` 設置最大高度（螢幕高度減去 400px 用於頁面其他元素）

- **第 2473 行**：為表頭 `<thead>` 添加固定定位樣式
  - 添加 `sticky` 類使用 sticky 定位
  - 添加 `top-0` 類將表頭固定在容器頂部
  - 添加 `z-10` 類確保表頭顯示在表格內容之上
  - 添加 `shadow-sm` 類在表頭底部添加輕微陰影效果

### 2. `src/index.css`
新增藥物工作流程表格固定表頭的專用 CSS 樣式（第 342-361 行）：

```css
/* 藥物工作流程表格固定表頭 */
.overflow-x-auto table thead {
  position: sticky;
  top: 0;
  z-index: 10;
}

.overflow-x-auto table thead th {
  background-color: rgb(249, 250, 251); /* bg-gray-50 */
  border-bottom: 2px solid rgb(229, 231, 235); /* border-gray-200 */
}

/* 確保固定表頭在 iPad 橫向模式也正常工作 */
@media (min-width: 1024px) and (max-width: 1280px) {
  .overflow-x-auto table thead th {
    background-color: rgb(249, 250, 251);
    font-size: 0.65rem;
    padding: 0.375rem 0.25rem;
  }
}
```

## 技術細節

### Sticky 定位原理
- `position: sticky` 是相對定位和固定定位的混合體
- 元素在滾動到指定閾值前為相對定位，超過閾值後變為固定定位
- `top: 0` 表示當元素距離容器頂部 0px 時開始固定

### 層級管理
- 使用 `z-index: 10` 確保表頭在表格內容之上
- 該 z-index 值低於頁面頂部導航欄（z-20 和 z-30），確保不會遮擋導航

### 背景色設置
- 明確設置 `background-color` 防止滾動時內容透過表頭顯示
- 使用 RGB 值而非 Tailwind 類確保樣式優先級

### 響應式設計
- 在 iPad 橫向模式（1024px-1280px）下調整表頭字體大小和內邊距
- 保持與之前的 iPad 優化一致

## 效果

修復後的體驗：
1. ✅ 日期欄（週日至週六）始終顯示在表格頂部
2. ✅ 用戶向下滾動查看更多處方時，日期欄保持可見
3. ✅ 日期欄的所有互動功能正常（點擊切換日期、紅點提示、懸停效果）
4. ✅ 表頭背景色和陰影效果讓固定位置更明顯
5. ✅ 在所有設備（桌面、iPad、手機）上都正常工作

## 測試建議

1. **基本功能測試**
   - 在藥物工作流程頁面向下滾動，確認日期欄保持在頂部
   - 點擊日期欄切換日期，確認功能正常
   - 檢查逾期提示紅點是否顯示正確

2. **響應式測試**
   - 桌面瀏覽器（>1280px）：確認表頭固定且樣式正確
   - iPad 橫向模式（1024px-1280px）：確認表頭字體和間距適配
   - 手機豎屏模式（<1024px）：確認表頭固定且可橫向滾動

3. **滾動性能測試**
   - 快速滾動表格，確認表頭無閃爍或延遲
   - 同時橫向和縱向滾動，確認表頭行為正常

4. **兼容性測試**
   - Chrome、Firefox、Safari、Edge 等主流瀏覽器
   - iOS Safari 和 Android Chrome 等移動瀏覽器

## 注意事項

1. **最大高度設置**
   - 表格容器設置了 `max-h-[calc(100vh-400px)]`
   - 這個值假設頁面其他元素（導航欄、控制面板等）約佔 400px
   - 如果頁面布局調整，可能需要修改這個值

2. **z-index 管理**
   - 表頭使用 `z-index: 10`
   - 確保不與其他固定元素衝突（如導航欄使用 z-20 和 z-30）

3. **瀏覽器兼容性**
   - `position: sticky` 在所有現代瀏覽器中都有良好支持
   - IE 11 不支持，但該項目不需要支持舊版 IE

## 相關文件
- `src/pages/MedicationWorkflow.tsx` - 藥物工作流程頁面
- `src/index.css` - 全局樣式表
